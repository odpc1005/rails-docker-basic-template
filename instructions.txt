# first install docker on your system

# run this command at the root of the dir that will contain the app
docker run -i -t --rm -v ${PWD}:/usr/src/app ruby:3 bash

# inside the container navigate to the app folder
cd /usr/src/app

gem install rails -v 6.1.4.6
#
# for only an api app
rails new name_of_app --api --skip-bundle --database=postgresql
# for a full rails app that uses webpacker and react
rails new name_of_app --webpack=react --skip-bundle --database=postgresql 
# keep in mind that to complete setup, you must run `bundle install` followed by `rails webpacker:install`
# exit the container
# copy the dockerfile and docker-compose into the folder of the app 'name_of_app'
# create hidden dir .env/development/ and files database and web with the following contents
mkdir .env
cd .env
mkdir development
cd development
touch database
touch web
echo 'POSTGRES_USER=user' >> database
echo 'POSTGRES_PASSWORD=development-password' >> database
echo 'POSTGRES_DB=name_of_app_development' >> database

echo 'DATABASE_HOST=database' >> web

# 'database' file
POSTGRES_USER=user
POSTGRES_PASSWORD=development-password
POSTGRES_DB=name_of_app_development
# 'web' file
DATABASE_HOST=database

# now you can build the container
docker-compose build web
# finish the instalation of webpack and react
docker-compose run web rails webpacker:install

# test the app working, need to check the database service did not start.
docker-compose up




